[
  {
    "objectID": "SWEEP_estimator_vignette.html",
    "href": "SWEEP_estimator_vignette.html",
    "title": "SWEEP Estimator Demo",
    "section": "",
    "text": "from SWEEP_estimator import main\nimport os\nimport geopandas as gpd\nimport matplotlib.pyplot as plt\nimport matplotlib.cm as cm\nimport matplotlib.colors as colors\n\nfrom sweep import config\nfrom SWEEP_estimator import main\nprint(\"Imports complete!\")\n\nImports complete!"
  },
  {
    "objectID": "SWEEP_estimator_vignette.html#spatial-emissions-estimation-query",
    "href": "SWEEP_estimator_vignette.html#spatial-emissions-estimation-query",
    "title": "SWEEP Estimator Demo",
    "section": "Spatial Emissions Estimation Query",
    "text": "Spatial Emissions Estimation Query\nRead in an AOI (optional: take a look!)\n\naoi_path = os.path.join(config.demo_dir, \"demo_multipoly.shp\")\naoi = gpd.read_file(aoi_path)\naoi.plot()\n\n\n\n\n\n\n\n\nThe Estimator uses data from CAL FIRE’s damage inspection database to identify structures damaged by wildfire. It uses parcel and footprint data to esitmate the square footage for each structure.\n\nemissions_gdf, agg_table, vehicle_table = main(\n    get_mode = \"use_default\",\n    filter_method = \"Spatial\",\n    polygon_input = aoi,\n    aggregate_fields=['AIR DISTRICT', 'AOI_INDEX']\n    )\nprint(\"Complete!\")\n\nLoading BSDB using use_default...\nApplying filter criteria...\nNo date filter applied.\nReprojecting polygon from EPSG:4326 to EPSG:3310.\n451 rows after spatial filtering with   fire_name    incident_n start_date                          group_id  \\\n0  Mosquito  CATNF 001371 2022-09-06  Mosquito_CATNF 001371_2022-09-06   \n1     River  CANEU 020628 2021-08-04     River_CANEU 020628_2021-08-04   \n\n  fp_source                                           geometry  \n0      FRAP  MULTIPOLYGON (((-120.56853 38.98437, -120.5686...  \n1      FRAP  POLYGON ((-120.99035 39.0844, -120.99116 39.08...  .\nEstimating emissions for pollutants: ['CO', 'NOx', 'SOx', 'PM', 'TOG']...\nC:\\Users\\gstarrs\\Projects\\CARB\\sweep_test\\data\\emissions_factors\nHolder efs from: C:\\Users\\gstarrs\\Projects\\CARB\\sweep_test\\data\\emissions_factors\\Holder_EFs.xlsx\nRequested pollutants: ['CO', 'NOx', 'SOx', 'PM', 'TOG']\nReturned pollutants: ['CO' 'NOx' 'SOx' 'PM' 'TOG']\nAggregating report by: ['AIR DISTRICT', 'AOI_INDEX']...\nAggregating on: ['AIR DISTRICT', 'AOI_INDEX']\nCalculating vehicle emissions with CARB factors...\n216\nRatio provided: 311.03999999999996 vehicles estimated using ratio: 1.44\nCARB efs from: C:\\Users\\gstarrs\\Projects\\CARB\\sweep_test\\data\\emissions_factors\\CARB_EFs.xlsx\nRequested pollutants: ['CO', 'NOx', 'SOx', 'PM']\nReturned pollutants: ['CO' 'NOx' 'SOx' 'PM']\nWriting Emissions Report to C:\\Users\\gstarrs\\Projects\\CARB\\sweep_test\\outputs\\SWEEP_20250610_160518\\Emissions_Report.xlsx\nWriting Aggregated Report to C:\\Users\\gstarrs\\Projects\\CARB\\sweep_test\\outputs\\SWEEP_20250610_160518\\Aggregated_Report.xlsx\nWriting Vehicle Report to C:\\Users\\gstarrs\\Projects\\CARB\\sweep_test\\outputs\\SWEEP_20250610_160518\\Vehicle_Report.xlsx\nSpatial data written to C:\\Users\\gstarrs\\Projects\\CARB\\sweep_test\\outputs\\SWEEP_20250610_160518\\Emissions_Spatial.gpkg\nComplete!\n\n\nIn the returned dataframes, columns from the aoi_source are retained and tagged with “AOI” at the start of the column. emissions_gdf is a geodataframe of each structure and their estimated emissions, along with parameters used in the estimation processl\n\nprint(emissions_gdf.crs)\nemissions_gdf.head(5)\n\nEPSG:3310\n\n\n\n\n\n\n\n\n\nAOI_FIRE_NAME\nAOI_INCIDENT_N\nAOI_START_DATE\nAOI_GROUP_ID\nAOI_FP_SOURCE\nAOI_INDEX\nINCIDENTNAME\nINCIDENTNUM\nSTART_DATE\nGLOBALID_DINS\n...\nFRAME_FACTOR\nCONTENTS_FACTOR\ngeometry\nE_CO_TN\nE_NOX_TN\nE_SOX_TN\nE_PM_TN\nE_TOG_TN\nMONTH\nYEAR\n\n\n\n\n60130\nRiver\nCANEU 020628\n2021-08-04\nRiver_CANEU 020628_2021-08-04\nFRAP\n1\nRiver\nCANEU 020628\n2021-08-04\n{5A6B63E7-0584-4A3D-9566-D1BED0D23610}\n...\n31.07\n5.87\nPOINT (-84115.053 121871.211)\n1.765\n0.008\n0.002\n1.005\n0.073\n8\n2021\n\n\n60132\nRiver\nCANEU 020628\n2021-08-04\nRiver_CANEU 020628_2021-08-04\nFRAP\n1\nRiver\nCANEU 020628\n2021-08-04\n{28A405D3-B735-4C6A-9030-5DB781554E63}\n...\n31.07\n5.87\nPOINT (-84075.412 121847.802)\n1.765\n0.008\n0.002\n1.005\n0.073\n8\n2021\n\n\n60133\nRiver\nCANEU 020628\n2021-08-04\nRiver_CANEU 020628_2021-08-04\nFRAP\n1\nRiver\nCANEU 020628\n2021-08-04\n{A8436F57-068C-4D19-B659-48B51EE6DCA0}\n...\n31.07\n5.87\nPOINT (-84093.56 121769.283)\n1.765\n0.008\n0.002\n1.005\n0.073\n8\n2021\n\n\n60135\nRiver\nCANEU 020628\n2021-08-04\nRiver_CANEU 020628_2021-08-04\nFRAP\n1\nRiver\nCANEU 020628\n2021-08-04\n{18869BDE-69CE-4F93-B844-2F9C416A57CD}\n...\n31.07\n5.87\nPOINT (-84135.956 121591.938)\n0.000\n0.000\n0.000\n0.000\n0.000\n8\n2021\n\n\n60136\nRiver\nCANEU 020628\n2021-08-04\nRiver_CANEU 020628_2021-08-04\nFRAP\n1\nRiver\nCANEU 020628\n2021-08-04\n{84EC24BE-B097-4FB8-8287-406BB9929E4F}\n...\n31.07\n5.87\nPOINT (-83735.224 122402.04)\n1.765\n0.008\n0.002\n1.005\n0.073\n8\n2021\n\n\n\n\n5 rows × 31 columns\n\n\n\nAs a geodataframe, the output is easily visualized using the geopandas and matplotlib libraries.\n\n# Read AOI layer\naoi = gpd.read_file(aoi_path)\naoi_gdf = aoi.to_crs(emissions_gdf.crs)\n\n# Create plot\nfig, ax = plt.subplots(figsize=(10, 10))\n\n# Plot AOI in light gray\naoi_gdf.plot(ax=ax, color='none', edgecolor='lightgray', linewidth=1)\n\n# Compute marker sizes based on E_CO_TN (adjust scaling factor as needed)\nsizes = emissions_gdf[\"E_CO_TN\"].fillna(0) * 5\n\n# Plot predicted emissions with symbol size proportional to E_CO_TN\nemissions_gdf.plot(\n    ax=ax,\n    color='orange',\n    alpha=0.6,\n    markersize=sizes\n)\n\n\n\n\n\n\n\n\nIn this demo run, we provided “AIR DISTRICT” and “AOI_INDEX” as the aggregation fields. As you can see our results are split by AOI_INDEX (the polygon) and AIR_DISTRICT. We get total emissions for each polygon in each air district.\n\nagg_table.head()\n\n\n\n\n\n\n\n\nAIR_DISTRICT\nAOI_INDEX\nE_CO_TN\nE_NOX_TN\nE_SOX_TN\nE_PM_TN\nE_TOG_TN\nDAMAGED_STRUCTURES\n\n\n\n\n0\nEl Dorado\n0\n70.53\n0.33\n0.07\n40.17\n2.92\n40\n\n\n1\nNorthern Sierra\n1\n150.28\n0.71\n0.14\n85.59\n6.22\n79\n\n\n2\nPlacer\n0\n55.88\n0.26\n0.05\n31.82\n2.32\n37\n\n\n3\nPlacer\n1\n129.24\n0.61\n0.12\n73.60\n5.35\n62\n\n\n\n\n\n\n\nWe can use the full dataframe to add other AOI attributes back in:\n\naoi_cols = [col for col in emissions_gdf.columns if col.startswith(\"AOI_\")]\n\n# Drop duplicates to get unique AOI records\nunique_aoi = emissions_gdf[aoi_cols].drop_duplicates()\n\n# Merge with agg_table on AOI_INDEX\nagg_table_aoi = agg_table.merge(unique_aoi, on=\"AOI_INDEX\", how=\"left\")\nagg_table_aoi.head()\n\n\n\n\n\n\n\n\nAIR_DISTRICT\nAOI_INDEX\nE_CO_TN\nE_NOX_TN\nE_SOX_TN\nE_PM_TN\nE_TOG_TN\nDAMAGED_STRUCTURES\nAOI_FIRE_NAME\nAOI_INCIDENT_N\nAOI_START_DATE\nAOI_GROUP_ID\nAOI_FP_SOURCE\n\n\n\n\n0\nEl Dorado\n0\n70.53\n0.33\n0.07\n40.17\n2.92\n40\nMosquito\nCATNF 001371\n2022-09-06\nMosquito_CATNF 001371_2022-09-06\nFRAP\n\n\n1\nNorthern Sierra\n1\n150.28\n0.71\n0.14\n85.59\n6.22\n79\nRiver\nCANEU 020628\n2021-08-04\nRiver_CANEU 020628_2021-08-04\nFRAP\n\n\n2\nPlacer\n0\n55.88\n0.26\n0.05\n31.82\n2.32\n37\nMosquito\nCATNF 001371\n2022-09-06\nMosquito_CATNF 001371_2022-09-06\nFRAP\n\n\n3\nPlacer\n1\n129.24\n0.61\n0.12\n73.60\n5.35\n62\nRiver\nCANEU 020628\n2021-08-04\nRiver_CANEU 020628_2021-08-04\nFRAP"
  },
  {
    "objectID": "SWEEP_estimator_vignette.html#automated-emissions-estimation-query",
    "href": "SWEEP_estimator_vignette.html#automated-emissions-estimation-query",
    "title": "SWEEP Estimator Demo",
    "section": "Automated Emissions Estimation Query",
    "text": "Automated Emissions Estimation Query\nIn an “automated” query, we can set filter_field, filter_values, and, optionally, date ranges without working through the interactive tool.\n\nemissions_gdf_auto, agg_table_auto, vehicle_table_auto = main(\n    get_mode = \"use_default\",\n    filter_method = \"automated\",\n    filter_field = \"Air Basin\",\n    field_values = [\"MOUNTAIN COUNTIES\", \"SAN JOAQUIN VALLEY\"],\n    apply_date_filter = True,\n    start_date = \"2018-01-01\",\n    end_date = \"2021-01-01\",\n    aggregate_fields=['AIR DISTRICT', 'YEAR', 'INCIDENT'],\n    write = \"No\"\n    )\nprint(\"Complete!\")\nemissions_gdf_auto.head()\n\nLoading BSDB using use_default...\nApplying filter criteria...\n59137 rows after date filtering from 2018-01-01 to 2021-01-01.\n4501 rows after filtering by Air Basin: ['MOUNTAIN COUNTIES', 'SAN JOAQUIN VALLEY'].\nEstimating emissions for pollutants: ['CO', 'NOx', 'SOx', 'PM', 'TOG']...\nC:\\Users\\gstarrs\\Projects\\CARB\\sweep_test\\data\\emissions_factors\nHolder efs from: C:\\Users\\gstarrs\\Projects\\CARB\\sweep_test\\data\\emissions_factors\\Holder_EFs.xlsx\nRequested pollutants: ['CO', 'NOx', 'SOx', 'PM', 'TOG']\nReturned pollutants: ['CO' 'NOx' 'SOx' 'PM' 'TOG']\nAggregating report by: ['AIR DISTRICT', 'YEAR', 'INCIDENT']...\nAggregating on: ['AIR DISTRICT', 'YEAR', 'INCIDENT']\nCalculating vehicle emissions with CARB factors...\n1207\nRatio provided: 1738.08 vehicles estimated using ratio: 1.44\nCARB efs from: C:\\Users\\gstarrs\\Projects\\CARB\\sweep_test\\data\\emissions_factors\\CARB_EFs.xlsx\nRequested pollutants: ['CO', 'NOx', 'SOx', 'PM']\nReturned pollutants: ['CO' 'NOx' 'SOx' 'PM']\nComplete!\n\n\n\n\n\n\n\n\n\nINCIDENTNAME\nINCIDENTNUM\nSTART_DATE\nGLOBALID_DINS\nDAMAGE\nSTRUCTURETYPE\nSTRUCTURECATEGORY\nCAT\nSQFT\nSQFT_SOURCE\n...\nFRAME_FACTOR\nCONTENTS_FACTOR\ngeometry\nE_CO_TN\nE_NOX_TN\nE_SOX_TN\nE_PM_TN\nE_TOG_TN\nMONTH\nYEAR\n\n\n\n\n456\nWagner\nCAMMU 016004\n2018-08-04\n{CA9382AF-9449-4988-98CE-C00CE3C55B32}\nDestroyed (&gt;50%)\nSingle Family Residence Single Story\nSingle Residence\nSFSS\n1458.000000\nMEDIAN\n...\n31.07\n5.87\nPOINT (-9578.918 -33825.916)\n1.765\n0.008\n0.002\n1.005\n0.073\n8\n2018\n\n\n1286\nFrazier\nCAFKU 007893\n2018-06-03\n{1765CBC6-51CC-4A19-883C-1F5509FC5A3F}\nMinor (10-25%)\nSingle Family Residence Single Story\nSingle Residence\nSFSS\n1752.000000\nPARCEL\n...\n31.07\n5.87\nPOINT (43612.19 -105244.953)\n0.000\n0.000\n0.000\n0.000\n0.000\n6\n2018\n\n\n1304\nOmega\nCAAEU 021770\n2018-08-01\n{39799A65-7A77-4BC3-BFD6-B042F640C830}\nNo Damage\nSingle Family Residence Single Story\nSingle Residence\nSFSS\n1391.000000\nPARCEL\n...\n31.07\n5.87\nPOINT (-89600.032 90657.664)\n0.000\n0.000\n0.000\n0.000\n0.000\n8\n2018\n\n\n1305\nOmega\nCAAEU 021770\n2018-08-01\n{92C931E6-9D5F-47B5-B82B-968E7AAA02D8}\nMinor (10-25%)\nSingle Family Residence Single Story\nSingle Residence\nSFSS\n1777.000000\nPARCEL\n...\n31.07\n5.87\nPOINT (-89674.345 90491.003)\n0.000\n0.000\n0.000\n0.000\n0.000\n8\n2018\n\n\n1306\nOmega\nCAAEU 021770\n2018-08-01\n{288E3A2E-03B8-4FA3-9A05-85503FBC3A4C}\nMinor (10-25%)\nSingle Family Residence Single Story\nSingle Residence\nSFSS\n1666.421397\nMODEL_A\n...\n31.07\n5.87\nPOINT (-89807.299 90485.001)\n0.000\n0.000\n0.000\n0.000\n0.000\n8\n2018\n\n\n\n\n5 rows × 25 columns\n\n\n\nAs specified in “aggregate_fields”, the aggregate table is summarized by year, air district, and fire incident.\n\nagg_table_auto\n\n\n\n\n\n\n\n\nAIR_DISTRICT\nYEAR\nINCIDENTNAME\nE_CO_TN\nE_NOX_TN\nE_SOX_TN\nE_PM_TN\nE_TOG_TN\nDAMAGED_STRUCTURES\n\n\n\n\n0\nAmador\n2018\nIrish\n1.77\n0.01\n0.00\n1.01\n0.07\n1.0\n\n\n1\nAmador\n2019\nWillow\n1.76\n0.01\n0.00\n1.00\n0.07\n1.0\n\n\n2\nCalaveras\n2018\nHorse\n3.38\n0.02\n0.00\n1.93\n0.14\n2.0\n\n\n3\nCalaveras\n2018\nWaverly\n1.98\n0.01\n0.00\n1.13\n0.08\n1.0\n\n\n4\nEl Dorado\n2018\nMeyers\n7.65\n0.04\n0.01\n4.36\n0.32\n4.0\n\n\n5\nEl Dorado\n2018\nOmega\n1.66\n0.01\n0.00\n0.94\n0.07\n1.0\n\n\n6\nEl Dorado\n2019\nCounty\n2.91\n0.01\n0.00\n1.66\n0.12\n2.0\n\n\n7\nEl Dorado\n2019\nRimrock\n1.76\n0.01\n0.00\n1.00\n0.07\n1.0\n\n\n8\nEl Dorado\n2020\nCameron\n3.37\n0.02\n0.00\n1.92\n0.14\n2.0\n\n\n9\nMariposa\n2018\nWagner\n16.10\n0.08\n0.02\n9.17\n0.67\n7.0\n\n\n10\nNorthern Sierra\n2020\nJones\n34.54\n0.16\n0.03\n19.67\n1.43\n18.0\n\n\n11\nNorthern Sierra\n2020\nNorth Complex\n48.68\n0.23\n0.05\n27.72\n2.02\n25.0\n\n\n12\nSan Joaquin Valley Unified\n2018\nFrazier\n1.76\n0.01\n0.00\n1.00\n0.07\n1.0\n\n\n13\nSan Joaquin Valley Unified\n2020\nCreek\n1645.57\n7.74\n1.57\n937.18\n68.16\n871.0\n\n\n14\nSan Joaquin Valley Unified\n2020\nSCU Lightning Cmplx\n85.78\n0.40\n0.09\n48.85\n3.55\n52.0\n\n\n15\nSan Joaquin Valley Unified\n2020\nSQF Complex\n470.61\n2.21\n0.42\n268.04\n19.52\n233.0\n\n\n16\nTuolumne\n2018\nRuby\n1.64\n0.01\n0.00\n0.93\n0.07\n1.0"
  }
]